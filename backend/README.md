# Backend API Documentation

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

```bash
cd backend
npm install
npm run dev
```

–°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –Ω–∞ `http://localhost:3001`

## üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Node.js 18+
- npm –∏–ª–∏ yarn
- OpenAI API Key (–¥–ª—è AI —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏)
- SQLite (–≤—Å—Ç—Ä–æ–µ–Ω —á–µ—Ä–µ–∑ better-sqlite3)

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞

1. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ `.env.example` –≤ `.env`
2. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:
   ```
   OPENAI_API_KEY=your_openai_api_key
   OPENAI_MODEL=gpt-4o-mini
   PORT=3001
   ```

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
backend/
‚îú‚îÄ‚îÄ server.js              # –ì–ª–∞–≤–Ω—ã–π —Å–µ—Ä–≤–µ—Ä Express
‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îú‚îÄ‚îÄ tours.js          # API –¥–ª—è —Ç—É—Ä–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ ai/
‚îÇ       ‚îî‚îÄ‚îÄ chat.js        # AI —á–∞—Ç —ç–Ω–¥–ø–æ–∏–Ω—Ç
‚îú‚îÄ‚îÄ ai-agent/
‚îÇ   ‚îú‚îÄ‚îÄ agent.js          # –û—Å–Ω–æ–≤–Ω–æ–π AI –∞–≥–µ–Ω—Ç
‚îÇ   ‚îú‚îÄ‚îÄ mcp-client.js     # MCP –∫–ª–∏–µ–Ω—Ç
‚îÇ   ‚îî‚îÄ‚îÄ features/
‚îÇ       ‚îú‚îÄ‚îÄ compare-tours.js    # Sub-agent –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
‚îÇ       ‚îî‚îÄ‚îÄ tour-details.js     # Sub-agent –¥–ª—è –¥–µ—Ç–∞–ª–µ–π
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îî‚îÄ‚îÄ mcp-config.json   # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è MCP —Å–µ—Ä–≤–µ—Ä–æ–≤
‚îî‚îÄ‚îÄ src/
    ‚îú‚îÄ‚îÄ db.js             # –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö SQLite
    ‚îî‚îÄ‚îÄ data/
        ‚îî‚îÄ‚îÄ tours.js      # –ú–æ–∫ –¥–∞–Ω–Ω—ã–µ —Ç—É—Ä–æ–≤
```

## üîå API Endpoints

### GET /api/tours

–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Ç—É—Ä–æ–≤ —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π.

**Query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `country` (string) - —Ñ–∏–ª—å—Ç—Ä –ø–æ —Å—Ç—Ä–∞–Ω–µ
- `category` (string) - —Ñ–∏–ª—å—Ç—Ä –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
- `priceMin` (number) - –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞
- `priceMax` (number) - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞

**–ü—Ä–∏–º–µ—Ä:**
```bash
GET /api/tours?country=Japan&priceMax=3000
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "tours": [...],
  "total": 5
}
```

### POST /api/ai/chat

–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ AI –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç—É.

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:**
```json
{
  "message": "–•–æ—á—É –ø–æ–µ—Ö–∞—Ç—å –≤ –Ø–ø–æ–Ω–∏—é, –±—é–¥–∂–µ—Ç –¥–æ 3000 –¥–æ–ª–ª–∞—Ä–æ–≤",
  "sessionId": "optional-session-id",
  "context": {}
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "message": "–Ø –Ω–∞—à–µ–ª –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö —Ç—É—Ä–æ–≤...",
  "tours": [...],
  "recommendations": [...],
  "context": {
    "user_preferences": {...},
    "session_id": "..."
  }
}
```

### GET /health

–ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è —Å–µ—Ä–≤–µ—Ä–∞.

**–û—Ç–≤–µ—Ç:**
```json
{
  "status": "ok",
  "message": "Tour Booking API is running"
}
```

## ü§ñ AI Agent

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

AI –∞–≥–µ–Ω—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç:
- **OpenAI GPT-4o-mini** –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç–≤–µ—Ç–æ–≤
- **Function Calling** –¥–ª—è –≤—ã–∑–æ–≤–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
- **MCP Servers** –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–∞–Ω–Ω—ã–º–∏
- **Sub-agents** –¥–ª—è —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∑–∞–¥–∞—á

### –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã (Tools)

1. **search_tours** - –ø–æ–∏—Å–∫ —Ç—É—Ä–æ–≤ –ø–æ –∫—Ä–∏—Ç–µ—Ä–∏—è–º
2. **get_tour_details** - –ø–æ–ª—É—á–µ–Ω–∏–µ –¥–µ—Ç–∞–ª–µ–π —Ç—É—Ä–∞
3. **compare_tours** - —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ç—É—Ä–æ–≤
4. **save_user_preferences** - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π
5. **get_user_history** - –ø–æ–ª—É—á–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤

### Sub-agents

#### Tour Comparison Sub-agent
- **–§–∞–π–ª:** `ai-agent/features/compare-tours.js`
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ç—É—Ä–æ–≤ –ø–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º
- **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è

#### Tour Details Sub-agent
- **–§–∞–π–ª:** `ai-agent/features/tour-details.js`
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ —Å –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏–µ–π
- **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ –¥–µ—Ç–∞–ª–µ–π

## üîå MCP Integration

### Context7 MCP

–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º –∏ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

**–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:**
- `save_user_preferences` - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π
- `get_user_history` - –ø–æ–ª—É—á–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏
- `get_user_context` - –ø–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
- `update_user_preferences` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π

### Database MCP

–†–∞–±–æ—Ç–∞ —Å –¥–∞–Ω–Ω—ã–º–∏ —Ç—É—Ä–æ–≤.

**–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:**
- `search_tours` - –ø–æ–∏—Å–∫ —Ç—É—Ä–æ–≤
- `get_tour_details` - –¥–µ—Ç–∞–ª–∏ —Ç—É—Ä–∞
- `compare_tours` - —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ç—É—Ä–æ–≤
- `get_tour_availability` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏

## üìä –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### SQLite

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è SQLite —á–µ—Ä–µ–∑ `better-sqlite3`.

**–¢–∞–±–ª–∏—Ü—ã:**
- `users` - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
- `bookings` - –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è

**–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è:**
–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ.

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞ –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
npm run dev

# –ó–∞–ø—É—Å–∫ production —Å–µ—Ä–≤–µ—Ä–∞
npm start
```

## üìù –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- **–û—Å–Ω–æ–≤–Ω–æ–π README:** [../README.md](../README.md)
- **AI Agent Architecture:** [../ai-agent/AGENT_ARCHITECTURE.md](../ai-agent/AGENT_ARCHITECTURE.md)
- **Workflow:** [../WORKFLOW.md](../WORKFLOW.md)

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –í—Å–µ –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤–∞–ª–∏–¥–∏—Ä—É—é—Ç—Å—è
- SQL –∑–∞–ø—Ä–æ—Å—ã –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω—ã
- CORS –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- API –∫–ª—é—á–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

## üêõ Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: OpenAI API –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `OPENAI_API_KEY` –≤ `.env` —Ñ–∞–π–ª–µ

### –ü—Ä–æ–±–ª–µ–º–∞: MCP —Å–µ—Ä–≤–µ—Ä—ã –Ω–µ –ø–æ–¥–∫–ª—é—á–∞—é—Ç—Å—è
**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –≤ `config/mcp-config.json`

### –ü—Ä–æ–±–ª–µ–º–∞: –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è
**–†–µ—à–µ–Ω–∏–µ:** –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –µ—Å—Ç—å –ø—Ä–∞–≤–∞ –Ω–∞ –∑–∞–ø–∏—Å—å –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–î–ª—è –≤–æ–ø—Ä–æ—Å–æ–≤ –∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π —Å–æ–∑–¥–∞–π—Ç–µ issue –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏:
https://github.com/AgytaiMukhatai/tour-booking
