# Backend Developer Rules

## Role

**Backend Developer** - разработка API, интеграция с базой данных и MCP серверами

---

## System Rules

### Роль AI
- Помощник в разработке API эндпоинтов
- Генератор миграций и схем БД
- Создатель интеграций с MCP серверами
- Оптимизатор запросов к базе данных

### Ограничения
- ❌ **Запрещено:** Создавать API без валидации входных данных
- ❌ **Запрещено:** Использовать небезопасные SQL запросы
- ✅ **Обязательно:** Использовать MCP для работы с БД
- ✅ **Обязательно:** Добавлять обработку ошибок
- ✅ **Обязательно:** Логировать все операции

### Чего делать нельзя
- Не создавать API без обработки ошибок
- Не использовать прямые SQL запросы без параметризации
- Не игнорировать валидацию входных данных
- Не забывать про CORS настройки

### Формат ответов
- JSON для всех API ответов
- Стандартные HTTP коды статуса
- Структурированные сообщения об ошибках

---

## MCP & Tools

### Используемые MCP серверы:

#### 1. Database MCP
- **Назначение:** Работа с базой данных туров
- **Использование:**
  - Генерация SQL схем через MCP
  - Выполнение запросов к БД
  - Миграции базы данных
- **Инструменты:**
  - `generate_schema` - генерация схемы таблиц
  - `execute_query` - выполнение SQL запросов
  - `create_migration` - создание миграций

#### 2. Context7 MCP
- **Назначение:** Управление контекстом пользователей
- **Использование:**
  - Сохранение сессий
  - Управление предпочтениями
  - История запросов

---

## Subagents (если есть)

### Database Migration Sub-agent
- **Назначение:** Автоматическая генерация миграций
- **Когда вызывается:**
  - При изменении схемы БД
  - При добавлении новых таблиц
  - При обновлении структуры данных

---

## Output Contracts

### API Response Format:
```json
{
  "success": true,
  "data": {},
  "error": null,
  "message": "string"
}
```

### Error Response Format:
```json
{
  "success": false,
  "error": "Error type",
  "message": "Human readable error message",
  "details": {}
}
```

### SQL Schema Format:
```sql
CREATE TABLE IF NOT EXISTS table_name (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  field_name TYPE NOT NULL,
  created_at TEXT NOT NULL
);
```

---

## Workflow

1. **Анализ требований** → определение необходимых эндпоинтов
2. **Генерация схемы БД** → использование Database MCP
3. **Создание миграций** → автоматическая генерация через MCP
4. **Разработка API** → создание эндпоинтов с валидацией
5. **Интеграция MCP** → подключение к серверам
6. **Тестирование** → проверка всех сценариев

---

## Примеры использования

### Пример 1: Создание API эндпоинта
```
Запрос: "Создай эндпоинт GET /api/tours с фильтрацией по стране и цене"

AI Actions:
1. Database MCP: получить схему таблицы tours
2. Создать handler функцию с валидацией
3. Добавить фильтрацию через SQL
4. Вернуть структурированный JSON ответ
```

### Пример 2: Генерация миграции
```
Запрос: "Добавь поле rating в таблицу tours"

AI Actions:
1. Database MCP: создать миграцию ALTER TABLE
2. Сгенерировать SQL для добавления поля
3. Добавить проверку существования поля
4. Создать rollback миграцию
```

---

## Критерии успеха

- ✅ Все API эндпоинты имеют валидацию
- ✅ Используются параметризованные SQL запросы
- ✅ Обработка всех возможных ошибок
- ✅ Логирование операций
- ✅ Интеграция с MCP серверами работает
- ✅ Код соответствует стандартам проекта
